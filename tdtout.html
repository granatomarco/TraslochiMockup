<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TDTOUT - Mediobanca Premier</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background: #f5f7fa; color: #2c3e50; padding-bottom: 60px; }
        .material-icons { vertical-align: middle; font-size: 20px; }
        
        .navbar { background: #202742; box-shadow: 0 2px 8px rgba(0,0,0,0.1); width: 100%; }
        .nav-container { max-width: 1600px; margin: 0 auto; padding: 30px 40px; display: flex; align-items: center; justify-content: space-between; min-height: 120px; }
        .logo-section { display: flex; align-items: center; }
        .brand-logo { height: 60px; width: auto; object-fit: contain; display: block; }
        
        .fallback-logo { display: flex; align-items: center; gap: 15px; }
        .logo-circle { width: 50px; height: 50px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #2c3e50; }
        .logo-circle .material-icons { font-size: 32px; }
        .brand-text { color: white; }
        .brand-name { font-size: 18px; font-weight: 600; letter-spacing: 2px; }
        .brand-subtitle { font-size: 12px; letter-spacing: 3px; margin-top: 2px; opacity: 0.9; }
        
        .nav-menu { display: flex; gap: 20px; }
        .nav-link { color: white; text-decoration: none; opacity: 0.7; font-size: 14px; font-weight: 500; padding: 8px 16px; border-radius: 4px; transition: all 0.3s; cursor: pointer;}
        .nav-link:hover, .nav-link.active { opacity: 1; background: rgba(255,255,255,0.1); }

        .container { max-width: 1600px; margin: 0 auto; padding: 30px 40px; }
        .page-header { margin-bottom: 30px; display: flex; justify-content: space-between; align-items: flex-end;}
        h1.page-title { font-size: 26px; font-weight: 400; color: #2c3e50; margin-bottom: 8px; }

        .results-section { background: white; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow: hidden; }
        .results-header { padding: 20px 30px; background: #f8f9fa; border-bottom: 1px solid #e9ecef; display: flex; justify-content: space-between; align-items: center; }
        h2.results-title { font-size: 16px; font-weight: 600; color: #2c3e50; display: flex; align-items: center; gap: 8px; }
        .results-count { font-size: 13px; color: #6c757d; }
        .table-wrapper { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        thead { background: #f8f9fa; }
        th { padding: 14px 16px; text-align: left; font-weight: 600; color: #2c3e50; font-size: 13px; border-bottom: 2px solid #e9ecef; white-space: nowrap; }
        td { padding: 14px 16px; border-bottom: 1px solid #e9ecef; font-size: 14px; color: #2c3e50; vertical-align: middle;}
        tr:hover { background: #f8f9fa; transition: background 0.2s; }

        .btn { padding: 10px 24px; border: none; border-radius: 4px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; gap: 8px; text-decoration: none;}
        .btn-primary { background: #2c3e50; color: white; }
        .btn-primary:hover { background: #3d5266; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #5a6268; }
        .btn-light { background: #b8cce4; color: #2c3e50; }
        .btn-light:hover { background: #a3b9d4; }
        .btn-alert { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;}
        
        .status-badge { padding: 5px 10px; border-radius: 3px; font-size: 12px; font-weight: 500; display: inline-block; }
        .status-inlavorazione { background: #fff3cd; color: #856404; }
        .status-errore { background: #f8d7da; color: #721c24; }
        .status-attesa { background: #e2e3e5; color: #383d41; border: 1px dashed #adb5bd;}
        .status-info { background: #e2e8f0; color: #334155; font-size: 11px; padding: 3px 6px; }

        .footer { background: #2c3e50; color: white; padding: 15px 40px; position: fixed; bottom: 0; left: 0; right: 0; display: flex; justify-content: space-between; align-items: center; font-size: 13px; z-index: 100; }

        /* Modali */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1000; animation: fadeIn 0.3s; }
        .modal.active { display: flex; align-items: center; justify-content: center; }
        .modal-content { background: white; border-radius: 4px; max-width: 850px; width: 90%; max-height: 85vh; overflow-y: auto; box-shadow: 0 4px 20px rgba(0,0,0,0.3); animation: slideUp 0.3s; }
        .modal-header { background: #2c3e50; color: white; padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { font-size: 18px; font-weight: 500; display: flex; align-items: center; gap: 8px; }
        .close-btn { background: none; border: none; color: white; cursor: pointer; line-height: 1; transition: opacity 0.3s; padding: 0; display: flex; align-items: center; }
        .close-btn .material-icons { font-size: 28px; }
        .close-btn:hover { opacity: 0.7; }
        .modal-body { padding: 30px; }
        .form-group label { font-size: 13px; font-weight: 500; color: #2c3e50; margin-bottom: 8px; display: block; }
        .detail-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .detail-item { padding: 15px; background: #f8f9fa; border-radius: 4px; }
        .detail-label { font-size: 12px; color: #6c757d; font-weight: 500; margin-bottom: 6px; }
        .detail-value { font-size: 15px; color: #2c3e50; font-weight: 500; }
        .detail-item-full { grid-column: 1 / -1; }
        .modal-footer { padding: 20px 30px; background: #f8f9fa; display: flex; gap: 10px; justify-content: flex-end; }
        
        .miglioria-box { background: white; border: 1px solid #e9ecef; border-left: 4px solid #3b82f6; padding: 20px; border-radius: 4px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .miglioria-title { font-weight: 600; font-size: 15px; color: #2c3e50; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;}
        .miglioria-text { font-size: 14px; color: #495057; line-height: 1.6;}
        .miglioria-text strong { color: #2c3e50; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        @media (max-width: 768px) {
            .nav-container { flex-direction: column; gap: 15px; padding: 20px; min-height: auto;}
            .page-header { flex-direction: column; align-items: flex-start; gap: 15px;}
            .container { padding: 20px; }
            .detail-grid { grid-template-columns: 1fr; }
            table { font-size: 12px; }
            th, td { padding: 10px 8px; }
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-container">
            <div class="logo-section">
                <img src="logo_MBP.png" alt="Logo Mediobanca Premier" class="brand-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="fallback-logo" style="display: none;">
                    <div class="logo-circle"><span class="material-icons">account_balance</span></div>
                    <div class="brand-text">
                        <div class="brand-name">MEDIOBANCA PREMIER</div>
                        <div class="brand-subtitle">ESTINZIONI SUCCESSIONI</div>
                    </div>
                </div>
            </div>
            <div class="nav-menu">
                <span class="nav-link" onclick="window.location.href='index.html'">Trasferibilità</span>
                <span class="nav-link" onclick="window.location.href='tdtin.html'">Traslochi IN (TDTIN)</span>
                <span class="nav-link active">Traslochi OUT (TDTOUT)</span>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <div>
                <h1 class="page-title">Monitoraggio Pratiche in Uscita (TDTOUT)</h1>
                <span style="font-size: 14px; color: #6c757d;">Gestione dei trasferimenti verso banche esterne e risoluzione anomalie</span>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-light" onclick="openModal('modal-migliorie')" style="background: #e2e8f0; border: 1px solid #cbd5e1;">
                    <span class="material-icons" style="color: #475569;">info</span> Dettaglio Migliorie
                </button>
                <button class="btn btn-alert" onclick="openModal('modal-sicav')">
                    <span class="material-icons">notifications_active</span> Notifiche Trasferimenti Fondi SICAV (1)
                </button>
            </div>
        </div>

        <div class="results-section">
            <div class="results-header">
                <h2 class="results-title"><span class="material-icons">outbound</span> Elenco Pratiche in Corso</h2>
                <span class="results-count">Mostrando pratiche attive</span>
            </div>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Codice Identificativo</th>
                            <th>Nominativo Intestatario</th>
                            <th>Coordinate Banca Uscente (ABI/CAB)</th>
                            <th>Stato Avanzamento Pratica</th>
                            <th>Dettaglio Segnalazione di Sistema</th>
                            <th>Gestione</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>OUT-2024-991</td>
                            <td>Mario Rossi</td>
                            <td>03058 / 01604</td>
                            <td><span class="status-badge status-inlavorazione">Controllo Preliminare in Corso</span></td>
                            <td>Ricerca anagrafica effettuata con successo</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>OUT-2024-992</td>
                            <td>Luigi Bianchi</td>
                            <td>03058 / 01604</td>
                            <td><span class="status-badge status-attesa">In Attesa di Caricamento Modulo Firmato</span></td>
                            <td>Manca la firma del cliente per procedere</td>
                            <td>
                                <button class="btn btn-primary" style="padding: 5px 10px; font-size: 12px;" onclick="openModal('modal-upload')">
                                    <span class="material-icons" style="font-size: 16px;">upload_file</span> Carica Modulo Firmato (PDF)
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td>OUT-2024-993</td>
                            <td>Anna Verdi</td>
                            <td>Dati Mancanti</td>
                            <td><span class="status-badge status-errore">Dati Bancari Mancanti o Errati</span></td>
                            <td>Coordinate bancarie della controparte non inserite</td>
                            <td>
                                <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 12px;">
                                    <span class="material-icons" style="font-size: 16px;">edit</span> Inserisci Coordinate Bancarie
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="footer">
        <span>&copy; 2026 Mediobanca Premier - Back Office Operativo</span>
        <span>Versione 2.0.0 (To-Be) | Utente: BO_Admin</span>
    </div>

    <div id="modal-upload" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><span class="material-icons">cloud_upload</span> Acquisizione Modulo di Trasferimento Firmato</h3>
                <button class="close-btn" onclick="closeModal('modal-upload')"><span class="material-icons">close</span></button>
            </div>
            <div class="modal-body">
                <div style="background: #e2e3e5; padding: 15px; border-radius: 4px; margin-bottom: 20px; font-size: 13px;">
                    <strong>Informazione per l'operatore:</strong> Il caricamento del modulo in questa sezione consente la ripresa automatica della lavorazione a sistema, sostituendo la precedente procedura basata sulle comunicazioni email.
                </div>
                <div class="form-group">
                    <label>Seleziona File (Formato richiesto: PDF)</label>
                    <input type="file" accept=".pdf" style="padding: 20px; border: 2px dashed #ddd; text-align: center; width: 100%;">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-upload')">Annulla Operazione</button>
                <button class="btn btn-primary"><span class="material-icons">check_circle</span> Salva File e Sblocca Pratica</button>
            </div>
        </div>
    </div>

    <div id="modal-sicav" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><span class="material-icons">mail_lock</span> Notifiche per Trasferimenti Fondi SICAV in Uscita</h3>
                <button class="close-btn" onclick="closeModal('modal-sicav')"><span class="material-icons">close</span></button>
            </div>
            <div class="modal-body">
                <p style="font-size: 14px; margin-bottom: 15px;">Le seguenti comunicazioni richiedono un controllo incrociato con gli enti esterni. Verifica la correttezza delle coordinate bancarie ed evadi la notifica cliccando l'apposito pulsante.</p>
                <div class="detail-grid">
                    <div class="detail-item detail-item-full" style="border-left: 4px solid #f39c12;">
                        <div class="detail-label">Codice Pratica: OUT-2024-995 | Nominativo Cliente: Mario Rossi</div>
                        <div class="detail-value" style="margin-bottom: 10px;">Coordinate Banca Uscente da verificare: ABI 03058 CAB 01604</div>
                        <button class="btn btn-light" style="font-size: 12px; padding: 6px 12px;" onclick="closeModal('modal-sicav')">
                            <span class="material-icons" style="font-size: 16px;">done_all</span> Conferma Ricezione e Chiudi Notifica
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-migliorie" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><span class="material-icons">verified</span> Changelog Completo delle Migliorie di Processo</h3>
                <button class="close-btn" onclick="closeModal('modal-migliorie')"><span class="material-icons">close</span></button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 25px; font-size: 14px; color: #495057; line-height: 1.6;">L'attuale architettura ridefinisce la gestione dei "Traslochi in Uscita", eliminando drasticamente la dipendenza dal client di posta elettronica e inserendo strumenti di Data Entry e tracciatura diretta nel sistema.</p>
                
                <div class="miglioria-box">
                    <div class="miglioria-title"><span class="status-badge status-info">Automazione</span> 1. Dematerializzazione delle Richieste per i Moduli Firmati</div>
                    <div class="miglioria-text">
                        <strong>Prima:</strong> All'interno dello "Step 1", per richiedere una copia del modulo di trasferimento firmato, il sistema generava un'email automatica indirizzata a <em>BO_Traslocotitoli@mediobancapremier.com</em>, imponendo un'attesa fuori applicativo.<br>
                        <strong>Oggi:</strong> Il ricorso all'invio dell'email è stato totalmente soppresso. Il gestionale segnala la necessità impostando lo stato in "Attesa Modulo Firmato". L'operatore carica il file PDF tramite il comando In-Line, sbloccando immediatamente il flusso di lavorazione.
                    </div>
                </div>

                <div class="miglioria-box">
                    <div class="miglioria-title"><span class="status-badge status-info">Automazione</span> 2. Gestione In-App delle Notifiche verso SICAV esterne</div>
                    <div class="miglioria-text">
                        <strong>Prima:</strong> Per trasferire informazioni legate ai trasferimenti (es. Cambio collocatore o comunicazione dell'ABI/CAB uscente), si redigevano email dirette alle SICAV o agli operatori preposti.<br>
                        <strong>Oggi:</strong> È stata predisposta una Coda Operativa centralizzata (bottone "Notifiche SICAV" nel cruscotto). Le informazioni sulle controparti bancarie sono visibili a video. L'operatore evade la notifica con un clic confermando l'avvenuta verifica a sistema.
                    </div>
                </div>

                <div class="miglioria-box">
                    <div class="miglioria-title"><span class="status-badge status-info">Operatività</span> 3. Data Entry Istantaneo per "Abi Data Not Found"</div>
                    <div class="miglioria-text">
                        <strong>Prima:</strong> La mancanza di parametri (Controparte ABI, SIP ABI, Descrizione ABI) causava la produzione del feedback terminale "Abi Data not found" sul DB e l'interruzione della pratica, che andava corretta via ticket o backend.<br>
                        <strong>Oggi:</strong> La pratica in anomalia risiede nel cruscotto in evidenza (Stato Errore). Attraverso il pulsante dedicato "Inserisci Coordinate Bancarie", l'operatore valorizza il campo mancante direttamente a video e permette la prosecuzione del workflow.
                    </div>
                </div>

                <div class="miglioria-box">
                    <div class="miglioria-title"><span class="status-badge status-info">Tracciatura</span> 4. Monitoraggio Centralizzato e DB Aggiornato</div>
                    <div class="miglioria-text">
                        <strong>Prima:</strong> Lo stato avanzamento di TDTOUT risiedeva unicamente in tabelle di backend invisibili all'utente finale (tabella "TraslochiOUT_Pratiche").<br>
                        <strong>Oggi:</strong> Il frontend interroga dinamicamente il DB "Settings" e le tabelle di servizio, fornendo una rappresentazione grafica, intellegibile e real-time dell'andamento di tutte le pratiche.
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-migliorie')">Chiudi Changelog</button>
            </div>
        </div>
    </div>

    <script>
        function openModal(modalId) { document.getElementById(modalId).classList.add('active'); }
        function closeModal(modalId) { document.getElementById(modalId).classList.remove('active'); }
        window.onclick = function(event) { if (event.target.classList.contains('modal')) event.target.classList.remove('active'); }
    </script>
</body>
</html>